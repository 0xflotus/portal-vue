{"version":3,"file":"portal-vue.js","sources":["../src/utils.js","../src/components/wormhole.js","../src/components/portal-target.vue","../src/components/portal.vue","../src/index.js"],"sourcesContent":["export function extractAttributes (el) {\n  const map = el.hasAttributes() ? el.attributes : []\n  const attrs = {}\n  for (let i = 0; i < map.length; i++) {\n    const attr = map[i]\n    if (attr.value) {\n      attrs[attr.name] = attr.value === '' ? true : attr.value\n    }\n  }\n  return attrs\n}\n\nexport function freeze (item) {\n  if (Array.isArray(item) || typeof item === 'object') {\n    return Object.freeze(item)\n  }\n  return item\n}\n","import Vue from 'vue'\nimport { freeze } from '../utils'\nconst routes = {}\n\nexport { routes }\n\nexport class Wormhole {\n  constructor (routes) {\n    this.routes = routes\n    this.clearQueue = []\n    this.updateQueue = []\n    this.runScheduled = false\n  }\n\n  send (name, passengers) {\n    const job = { name, passengers }\n    this.updateQueue.push(job)\n    this._scheduleRun()\n  }\n\n  close (name) {\n    const job = { name }\n    this.clearQueue.push(job)\n    this._scheduleRun()\n  }\n\n  _scheduleRun () {\n    if (!this.runScheduled) {\n      this.runScheduled = true\n\n      // setTimeout(this._runQueue.bind(this), 0)\n      Vue.nextTick(this._runQueue.bind(this))\n    }\n  }\n\n  _runQueue () {\n    const keys = Object.keys(this.routes)\n\n    this.clearQueue.forEach(({ name }) => {\n      if (keys.includes(name)) {\n        this.routes[name] = undefined\n      }\n    })\n    this.clearQueue = []\n\n    this.updateQueue.forEach(({ name, passengers }) => {\n      if (keys.includes(name)) {\n        this.routes[name] = freeze(passengers)\n      } else {\n        Vue.set(this.routes, name, freeze(passengers))\n      }\n    })\n    this.updateQueue = []\n\n    this.runScheduled = false\n  }\n\n}\nconst wormhole = new Wormhole(routes)\nexport default wormhole\n","<script>\n  import { routes } from './wormhole'\n\n  export default {\n    abstract: true,\n    name: 'portalTarget',\n    props: {\n      attributes: { type: Object },\n      name: { type: String, required: true },\n      slim: { type: Boolean, default: false },\n      tag: { type: String, default: 'div' },\n    },\n    data () {\n      return {\n        routes,\n      }\n    },\n\n    mounted () {\n      this.updateAttributes()\n    },\n    updated () {\n      this.updateAttributes()\n    },\n    beforeDestroy () {\n      this.$el.innerHTML = ''\n    },\n\n    methods: {\n      updateAttributes () {\n        if (this.attributes) {\n          const attrs = this.attributes\n          const el = this.$el\n\n          // special treatment for class\n          if (attrs.class) {\n            attrs.class.trim().split(' ').forEach((klass) => {\n              el.classList.add(klass)\n            })\n            delete attrs.class\n          }\n\n          const keys = Object.keys(attrs)\n\n          for (let i = 0; i < keys.length; i++) {\n            el.setAttribute(keys[i], attrs[keys[i]])\n          }\n        }\n      },\n    },\n    computed: {\n      passengers () {\n        return this.routes[this.name] || null\n      },\n      renderSlim () {\n        const passengers = this.passengers || []\n        return passengers.length === 1 && !this.attributes && this.slim\n      },\n    },\n\n    render (h) {\n      const children = this.passengers || []\n\n      if (this.renderSlim) {\n        return children[0]\n      } else {\n        return h(this.tag, {\n          class: { 'vue-portal-target': true },\n        }, children)\n      }\n    },\n  }\n</script>\n","<script>\n  import Vue from 'vue'\n  import wormhole from './wormhole'\n  import Target from './portal-target'\n  import { extractAttributes } from '../utils'\n\n  const inBrowser = (typeof window !== 'undefined')\n\n  export default {\n    abstract: true,\n    name: 'portal',\n    props: {\n      /* global HTMLElement */\n      disabled: { type: Boolean, default: false },\n      slim: { type: Boolean, default: false },\n      tag: { type: [String], default: 'DIV' },\n      targetEl: { type: inBrowser ? [String, HTMLElement] : String },\n      to: { type: String, default: () => String(Math.round(Math.random() * 10000000)) },\n    },\n\n    mounted () {\n      if (this.targetEl) {\n        this.mountToTarget()\n      }\n      if (!this.disabled) {\n        this.sendUpdate()\n      }\n    },\n\n    updated () {\n      if (this.disabled) {\n        this.clear()\n      } else {\n        this.sendUpdate()\n      }\n    },\n\n    beforeDestroy () {\n      this.clear()\n      if (this.mountedComp) {\n        this.mountedComp.$destroy()\n      }\n    },\n\n    watch: {\n      to (newValue, oldValue) {\n        oldValue && this.clear(oldValue)\n        this.sendUpdate()\n      },\n      targetEl (newValue, oldValue) {\n        this.mountToTarget()\n      },\n    },\n\n    methods: {\n\n      sendUpdate () {\n        if (this.to) {\n          if (this.$slots.default) {\n            wormhole.send(this.to, [...this.$slots.default])\n          }\n        } else if (!this.to && !this.targetEl) {\n          console.warn('[vue-portal]: You have to define a targte via the `to` prop.')\n        }\n      },\n\n      clear (target) {\n        wormhole.close(target || this.to)\n      },\n\n      mountToTarget () {\n        let el\n        const target = this.targetEl\n\n        if (typeof target === 'string') {\n          el = document.querySelector(this.targetEl)\n        } else if (target instanceof HTMLElement) {\n          el = target\n        } else {\n          console.warn('[vue-portal]: value of targetEl must eb of type String or HTMLElement')\n          return\n        }\n\n        const attributes = extractAttributes(el)\n\n        if (el) {\n          const target = new Vue({\n            ...Target,\n            parent: this,\n            propsData: {\n              name: this.to,\n              tag: el.tagName,\n              attributes,\n            },\n          })\n          target.$mount(el)\n          this.mountedComp = target\n        } else {\n          console.warn('[vue-portal]: The specified targetEl ' + this.targetEl + ' was not found')\n        }\n      },\n    },\n\n    render (h) {\n      const children = this.$slots.default || []\n\n      if (children.length && this.disabled) {\n        return children.length <= 1 && this.slim\n          ? children[0]\n          : h(this.tag, children)\n      } else {\n        return h(this.tag, { class: { 'v-portal': true }, style: { display: 'none' }, key: 'v-portal-placeholder' })\n      }\n    },\n  }\n</script>\n","import Portal from './components/portal.vue'\nimport PortalTarget from './components/portal-target.vue'\n\nfunction install (Vue, opts = {}) {\n  Vue.component(opts.portalName || 'portal', Portal)\n  Vue.component(opts.portalTargetName || 'portal-target', PortalTarget)\n}\nif (typeof window !== 'undefined' && window.Vue) {\n  window.Vue.use({ install: install })\n}\n\nexport default {\n  install,\n  Portal,\n  PortalTarget,\n}\n"],"names":["extractAttributes","el","map","hasAttributes","attributes","attrs","i","length","attr","value","name","freeze","item","Array","isArray","Object","routes","Wormhole","clearQueue","updateQueue","runScheduled","passengers","job","push","_scheduleRun","nextTick","_runQueue","bind","keys","forEach","includes","undefined","set","wormhole","type","String","required","Boolean","default","updateAttributes","$el","innerHTML","class","trim","split","klass","classList","add","setAttribute","slim","h","children","renderSlim","tag","inBrowser","window","HTMLElement","Math","round","random","targetEl","mountToTarget","disabled","sendUpdate","clear","mountedComp","$destroy","newValue","oldValue","to","$slots","send","warn","target","close","document","querySelector","Vue","Target","tagName","$mount","style","display","key","install","opts","component","portalName","Portal","portalTargetName","PortalTarget","use"],"mappings":"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"}